<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì•½ ê´€ë¦¬ ë‹¬ë ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .reservation-bar {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .reservation-bar:hover {
            opacity: 0.8;
        }
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 50;
            justify-content: center;
            align-items: flex-end;
            padding: 1rem;
        }
        .modal.md\:items-center {
            align-items: center;
        }
        .modal.active {
            display: flex;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100">
    <div id="app" class="min-h-screen p-4 md:p-8">
        <div class="max-w-6xl mx-auto">
            <!-- í—¤ë” -->
            <div class="mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">ì˜ˆì•½ ê´€ë¦¬ ë‹¬ë ¥</h1>
                <p class="text-gray-600">ëª¨ë“  ì˜ˆì•½ì„ í•œ í™”ë©´ì—ì„œ ê´€ë¦¬í•˜ì„¸ìš”</p>
            </div>

            <!-- API ì„¤ì • ë°” -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h3 class="font-semibold text-blue-900 mb-2">ë¶€í‚¹ë‹·ì»´ API ì—°ë™</h3>
                        <p class="text-sm text-blue-700">API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì˜ˆì•½ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    </div>
                    <button id="settingsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium whitespace-nowrap">
                        ì„¤ì •
                    </button>
                </div>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ ë°” -->
            <div class="bg-white rounded-lg shadow-sm p-4 md:p-6 mb-6 border border-gray-200">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <!-- ì›” ë„¤ë¹„ê²Œì´ì…˜ -->
                    <div class="flex items-center gap-4">
                        <button id="prevBtn" class="p-2 hover:bg-gray-100 rounded-lg transition">
                            <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <h2 id="monthDisplay" class="text-xl font-bold text-gray-900 min-w-32 text-center">2025ë…„ 3ì›”</h2>
                        <button id="nextBtn" class="p-2 hover:bg-gray-100 rounded-lg transition">
                            <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- ê°ì‹¤ í•„í„° ë° ì¶”ê°€ ë²„íŠ¼ -->
                    <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                        <select id="roomFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                            <option value="all">ì „ì²´ ê°ì‹¤</option>
                            <option value="1">ê°ì‹¤ 1</option>
                            <option value="2">ê°ì‹¤ 2</option>
                            <option value="3">ê°ì‹¤ 3</option>
                            <option value="4">ê°ì‹¤ 4</option>
                            <option value="5">ê°ì‹¤ 5</option>
                            <option value="6">ê°ì‹¤ 6</option>
                            <option value="7">ê°ì‹¤ 7</option>
                            <option value="8">ê°ì‹¤ 8</option>
                            <option value="9">ê°ì‹¤ 9</option>
                            <option value="10">ê°ì‹¤ 10</option>
                        </select>

                        <button id="addBtn" class="flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium whitespace-nowrap">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            <span>ì˜ˆì•½ ì¶”ê°€</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ë‹¬ë ¥ -->
            <div id="calendar" class="w-full bg-white rounded-lg shadow-sm border border-gray-200 overflow-x-auto mb-6"></div>

            <!-- ê°ì‹¤ ìƒíƒœ ëŒ€ì‹œë³´ë“œ -->
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">ê°ì‹¤ ìƒíƒœ í˜„í™©</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3" id="roomStatusGrid"></div>
            </div>

            <!-- ë²”ë¡€ -->
            <div class="bg-white rounded-lg shadow-sm p-4 md:p-6 border border-gray-200">
                <h3 class="font-semibold text-gray-900 mb-3">ì˜ˆì•½ ì¶œì²˜</h3>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-blue-500"></div>
                        <span class="text-sm text-gray-700">ì—ì–´ë¹„ì•¤ë¹„</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-green-500"></div>
                        <span class="text-sm text-gray-700">ë¶€í‚¹ë‹·ì»´</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-yellow-500"></div>
                        <span class="text-sm text-gray-700">ì§ì ‘ ì˜ˆì•½</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-purple-500"></div>
                        <span class="text-sm text-gray-700">ì¸ìŠ¤íƒ€/DM</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-amber-400"></div>
                        <span class="text-sm text-gray-700">ì¹´í†¡</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê°ì‹¤ ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ -->
    <div id="roomStatusModal" class="modal">
        <div class="bg-white rounded-t-2xl md:rounded-lg w-full md:w-96 max-h-screen md:max-h-none overflow-y-auto shadow-lg">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">ê°ì‹¤ ìƒíƒœ ë³€ê²½</h3>
                <button id="closeRoomStatusBtn" class="p-1 hover:bg-gray-100 rounded-lg transition">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="p-6 space-y-4">
                <div>
                    <p class="text-lg font-semibold text-gray-900 mb-4" id="roomStatusTitle">ê°ì‹¤ 1</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">ìƒíƒœ ì„ íƒ</label>
                    <div class="space-y-2" id="statusOptions"></div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">í˜„ì¬ ì†ë‹˜ ì´ë¦„</label>
                    <input id="roomGuestName" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì†ë‹˜ ì´ë¦„">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì²´í¬ì¸ ì‹œê°„</label>
                    <input id="roomCheckInTime" type="time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì²´í¬ì•„ì›ƒ ì‹œê°„</label>
                    <input id="roomCheckOutTime" type="time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div class="flex gap-3 pt-4">
                    <button id="cancelRoomStatusBtn" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition">ì·¨ì†Œ</button>
                    <button id="saveRoomStatusBtn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API ì„¤ì • ëª¨ë‹¬ -->
    <div id="settingsModal" class="modal">
        <div class="bg-white rounded-t-2xl md:rounded-lg w-full md:w-96 max-h-screen md:max-h-none overflow-y-auto shadow-lg">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">API ì„¤ì •</h3>
                <button id="closeSettingsBtn" class="p-1 hover:bg-gray-100 rounded-lg transition">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="p-6 space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800">
                        <strong>ë¶€í‚¹ë‹·ì»´ API í‚¤ ë°œê¸‰ ë°©ë²•:</strong><br>
                        1. <a href="https://partner.booking.com" target="_blank" class="underline hover:text-blue-600">Booking Partner Center</a>ì— ë¡œê·¸ì¸<br>
                        2. API ì„¤ì •ì—ì„œ API í‚¤ ìƒì„±<br>
                        3. ì•„ë˜ì— ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì˜ˆì•½ ê°€ì ¸ì˜¤ê¸°
                    </p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë¶€í‚¹ë‹·ì»´ API í‚¤</label>
                    <input id="bookingApiKey" type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="API í‚¤ ì…ë ¥">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë¶€í‚¹ë‹·ì»´ Property ID</label>
                    <input id="bookingPropertyId" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Property ID ì…ë ¥">
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <p class="text-sm text-yellow-800">
                        <strong>ì—°ë™ ìƒíƒœ:</strong> <span id="syncStatus" class="font-semibold">ì—°ë™ ì•ˆë¨</span>
                    </p>
                </div>

                <div class="flex gap-3 pt-4">
                    <button id="testConnectionBtn" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                    <button id="syncNowBtn" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">ì§€ê¸ˆ ë™ê¸°í™”</button>
                </div>

                <div class="flex gap-3 pt-4">
                    <button id="cancelSettingsBtn" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition">ì·¨ì†Œ</button>
                    <button id="saveSettingsBtn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì•½ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addModal" class="modal">
        <div class="bg-white rounded-t-2xl md:rounded-lg w-full md:w-96 max-h-screen md:max-h-none overflow-y-auto shadow-lg">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">ìƒˆ ì˜ˆì•½ ë“±ë¡</h3>
                <button id="closeAddBtn" class="p-1 hover:bg-gray-100 rounded-lg transition">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ê°ì‹¤ ì„ íƒ</label>
                    <select id="modalRoomId" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="1">ê°ì‹¤ 1</option>
                        <option value="2">ê°ì‹¤ 2</option>
                        <option value="3">ê°ì‹¤ 3</option>
                        <option value="4">ê°ì‹¤ 4</option>
                        <option value="5">ê°ì‹¤ 5</option>
                        <option value="6">ê°ì‹¤ 6</option>
                        <option value="7">ê°ì‹¤ 7</option>
                        <option value="8">ê°ì‹¤ 8</option>
                        <option value="9">ê°ì‹¤ 9</option>
                        <option value="10">ê°ì‹¤ 10</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ˆì•½ì ì´ë¦„</label>
                    <input id="modalGuestName" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì˜ˆ: í™ê¸¸ë™">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì²´í¬ì¸</label>
                        <input id="modalCheckIn" type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì²´í¬ì•„ì›ƒ</label>
                        <input id="modalCheckOut" type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ˆì•½ ì¶œì²˜</label>
                    <select id="modalSource" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="direct">ì§ì ‘ ì˜ˆì•½</option>
                        <option value="airbnb">ì—ì–´ë¹„ì•¤ë¹„</option>
                        <option value="booking">ë¶€í‚¹ë‹·ì»´</option>
                        <option value="instagram">ì¸ìŠ¤íƒ€/DM</option>
                        <option value="kakao">ì¹´í†¡</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ëª¨ (ì„ íƒ)</label>
                    <textarea id="modalMemo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" rows="3" placeholder="íŠ¹ë³„í•œ ìš”ì²­ì‚¬í•­ì´ ìˆë‚˜ìš”?"></textarea>
                </div>

                <div class="flex gap-3 pt-4">
                    <button id="cancelAddBtn" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition">ì·¨ì†Œ</button>
                    <button id="saveBtn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì•½ ìƒì„¸ ëª¨ë‹¬ -->
    <div id="detailModal" class="modal">
        <div class="bg-white rounded-t-2xl md:rounded-lg w-full md:w-96 max-h-screen md:max-h-none overflow-y-auto shadow-lg">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">ì˜ˆì•½ ìƒì„¸</h3>
                <button id="closeDetailBtn" class="p-1 hover:bg-gray-100 rounded-lg transition">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div id="detailContent" class="p-6 space-y-4"></div>
        </div>
    </div>

    <script>
        // ìƒíƒœ ê´€ë¦¬
        const state = {
            currentMonth: new Date(2025, 2, 1),
            selectedRoom: 'all',
            reservations: [
                {
                    id: 1,
                    roomId: 1,
                    roomName: 'ê°ì‹¤ 1',
                    guestName: 'í™ê¸¸ë™',
                    checkIn: new Date(2025, 2, 3),
                    checkOut: new Date(2025, 2, 7),
                    source: 'airbnb',
                    memo: 'í…ŒìŠ¤íŠ¸ ì˜ˆì•½',
                },
                {
                    id: 2,
                    roomId: 2,
                    roomName: 'ê°ì‹¤ 2',
                    guestName: 'Anna',
                    checkIn: new Date(2025, 2, 9),
                    checkOut: new Date(2025, 2, 12),
                    source: 'booking',
                    memo: '',
                },
                {
                    id: 3,
                    roomId: 1,
                    roomName: 'ê°ì‹¤ 1',
                    guestName: 'ê¹€ì² ìˆ˜',
                    checkIn: new Date(2025, 2, 15),
                    checkOut: new Date(2025, 2, 18),
                    source: 'direct',
                    memo: 'ì¡°ìš©í•œ ë°© ìš”ì²­',
                },
            ],
            rooms: [
                { id: 1, name: 'ê°ì‹¤ 1' },
                { id: 2, name: 'ê°ì‹¤ 2' },
                { id: 3, name: 'ê°ì‹¤ 3' },
                { id: 4, name: 'ê°ì‹¤ 4' },
                { id: 5, name: 'ê°ì‹¤ 5' },
                { id: 6, name: 'ê°ì‹¤ 6' },
                { id: 7, name: 'ê°ì‹¤ 7' },
                { id: 8, name: 'ê°ì‹¤ 8' },
                { id: 9, name: 'ê°ì‹¤ 9' },
                { id: 10, name: 'ê°ì‹¤ 10' },
            ],
            roomStatus: {
                1: { status: 'occupied', guestName: 'í™ê¸¸ë™', checkInTime: '14:00', checkOutTime: '11:00' },
                2: { status: 'cleaning', guestName: '', checkInTime: '', checkOutTime: '' },
                3: { status: 'empty', guestName: '', checkInTime: '', checkOutTime: '' },
                4: { status: 'occupied', guestName: 'ê¹€ì² ìˆ˜', checkInTime: '15:30', checkOutTime: '10:00' },
                5: { status: 'empty', guestName: '', checkInTime: '', checkOutTime: '' },
                6: { status: 'occupied', guestName: 'Anna', checkInTime: '16:00', checkOutTime: '12:00' },
                7: { status: 'cleaning', guestName: '', checkInTime: '', checkOutTime: '' },
                8: { status: 'empty', guestName: '', checkInTime: '', checkOutTime: '' },
                9: { status: 'occupied', guestName: 'ë°•ì¤€í˜¸', checkInTime: '14:30', checkOutTime: '11:30' },
                10: { status: 'empty', guestName: '', checkInTime: '', checkOutTime: '' },
            },
            selectedRoomId: null,
            bookingApi: {
                apiKey: localStorage.getItem('bookingApiKey') || '',
                propertyId: localStorage.getItem('bookingPropertyId') || '',
                isConnected: false,
            },
        };

        const sourceColors = {
            airbnb: 'bg-blue-500',
            booking: 'bg-green-500',
            direct: 'bg-yellow-500',
            instagram: 'bg-purple-500',
            kakao: 'bg-amber-400',
        };

        const sourceLabels = {
            airbnb: 'ì—ì–´ë¹„ì•¤ë¹„',
            booking: 'ë¶€í‚¹ë‹·ì»´',
            direct: 'ì§ì ‘ ì˜ˆì•½',
            instagram: 'ì¸ìŠ¤íƒ€/DM',
            kakao: 'ì¹´í†¡',
        };

        // DOM ìš”ì†Œ
        const monthDisplay = document.getElementById('monthDisplay');
        const calendarDiv = document.getElementById('calendar');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const roomFilter = document.getElementById('roomFilter');
        const addBtn = document.getElementById('addBtn');
        const addModal = document.getElementById('addModal');
        const detailModal = document.getElementById('detailModal');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');

        // ë¶€í‚¹ë‹·ì»´ API í•¨ìˆ˜
        async function testBookingConnection() {
            const apiKey = document.getElementById('bookingApiKey').value;
            const propertyId = document.getElementById('bookingPropertyId').value;

            if (!apiKey || !propertyId) {
                alert('API í‚¤ì™€ Property IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            try {
                document.getElementById('testConnectionBtn').disabled = true;
                document.getElementById('testConnectionBtn').textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';

                // ì‹¤ì œ ë¶€í‚¹ë‹·ì»´ API í˜¸ì¶œ (ì˜ˆì‹œ)
                const response = await fetch('https://api.booking.com/v1/bookings', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                    },
                });

                if (response.status === 401 || response.status === 403) {
                    alert('API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                    document.getElementById('syncStatus').textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨';
                    document.getElementById('syncStatus').className = 'font-semibold text-red-600';
                } else if (response.ok) {
                    alert('ì—°ê²° ì„±ê³µ! ì´ì œ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                    document.getElementById('syncStatus').textContent = 'âœ… ì—°ê²°ë¨';
                    document.getElementById('syncStatus').className = 'font-semibold text-green-600';
                    state.bookingApi.isConnected = true;
                } else {
                    // ë°ëª¨ ëª¨ë“œ - í…ŒìŠ¤íŠ¸ìš©
                    alert('ë°ëª¨ ëª¨ë“œ: ë¶€í‚¹ë‹·ì»´ API í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                    document.getElementById('syncStatus').textContent = 'âœ… ì—°ê²°ë¨ (ë°ëª¨)';
                    document.getElementById('syncStatus').className = 'font-semibold text-green-600';
                    state.bookingApi.isConnected = true;
                }
            } catch (error) {
                alert('ì—°ê²° ì˜¤ë¥˜: ' + error.message);
                document.getElementById('syncStatus').textContent = 'âŒ ì—°ê²° ì˜¤ë¥˜';
                document.getElementById('syncStatus').className = 'font-semibold text-red-600';
            } finally {
                document.getElementById('testConnectionBtn').disabled = false;
                document.getElementById('testConnectionBtn').textContent = 'ì—°ê²° í…ŒìŠ¤íŠ¸';
            }
        }

        async function syncBookingReservations() {
            const apiKey = document.getElementById('bookingApiKey').value;
            const propertyId = document.getElementById('bookingPropertyId').value;

            if (!apiKey || !propertyId) {
                alert('API í‚¤ì™€ Property IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            try {
                document.getElementById('syncNowBtn').disabled = true;
                document.getElementById('syncNowBtn').textContent = 'ë™ê¸°í™” ì¤‘...';

                // ì‹¤ì œ ë¶€í‚¹ë‹·ì»´ ì˜ˆì•½ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì˜ˆì‹œ)
                const response = await fetch(`https://api.booking.com/v1/bookings?property_id=${propertyId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    // ë¶€í‚¹ë‹·ì»´ ì˜ˆì•½ ë°ì´í„°ë¥¼ ìš°ë¦¬ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    if (data.bookings && Array.isArray(data.bookings)) {
                        data.bookings.forEach(booking => {
                            const newReservation = {
                                id: `booking_${booking.booking_id}`,
                                roomId: (booking.room_id % 10) + 1, // ê°ì‹¤ 10ê°œë¡œ ë¶„ë°°
                                roomName: `ê°ì‹¤ ${(booking.room_id % 10) + 1}`,
                                guestName: booking.guest_name || 'ì†ë‹˜',
                                checkIn: new Date(booking.check_in),
                                checkOut: new Date(booking.check_out),
                                source: 'booking',
                                memo: `ë¶€í‚¹ID: ${booking.booking_id}`,
                            };

                            // ì¤‘ë³µ ì œê±°
                            const exists = state.reservations.find(r => r.id === newReservation.id);
                            if (!exists) {
                                state.reservations.push(newReservation);
                            }
                        });
                        alert('ë™ê¸°í™” ì™„ë£Œ! ' + data.bookings.length + 'ê°œ ì˜ˆì•½ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                        renderCalendar();
                    }
                } else {
                    // ë°ëª¨ ëª¨ë“œ - ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€
                    const sampleBookings = [
                        {
                            id: `booking_demo_${Date.now()}`,
                            roomId: 3,
                            roomName: 'ê°ì‹¤ 3',
                            guestName: 'John Smith',
                            checkIn: new Date(2025, 2, 20),
                            checkOut: new Date(2025, 2, 23),
                            source: 'booking',
                            memo: 'ë¶€í‚¹ë‹·ì»´ ë°ëª¨ ì˜ˆì•½',
                        },
                        {
                            id: `booking_demo_${Date.now() + 1}`,
                            roomId: 5,
                            roomName: 'ê°ì‹¤ 5',
                            guestName: 'Emma Wilson',
                            checkIn: new Date(2025, 2, 10),
                            checkOut: new Date(2025, 2, 14),
                            source: 'booking',
                            memo: 'ë¶€í‚¹ë‹·ì»´ ë°ëª¨ ì˜ˆì•½',
                        },
                    ];

                    sampleBookings.forEach(booking => {
                        const exists = state.reservations.find(r => r.id === booking.id);
                        if (!exists) {
                            state.reservations.push(booking);
                        }
                    });

                    alert('ë°ëª¨ ëª¨ë“œ: ìƒ˜í”Œ ì˜ˆì•½ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                    renderCalendar();
                }
            } catch (error) {
                alert('ë™ê¸°í™” ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('syncNowBtn').disabled = false;
                document.getElementById('syncNowBtn').textContent = 'ì§€ê¸ˆ ë™ê¸°í™”';
            }
        }

        function saveApiSettings() {
            const apiKey = document.getElementById('bookingApiKey').value;
            const propertyId = document.getElementById('bookingPropertyId').value;

            localStorage.setItem('bookingApiKey', apiKey);
            localStorage.setItem('bookingPropertyId', propertyId);

            state.bookingApi.apiKey = apiKey;
            state.bookingApi.propertyId = propertyId;

            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            hideSettingsModal();
        }

        function showSettingsModal() {
            document.getElementById('bookingApiKey').value = state.bookingApi.apiKey;
            document.getElementById('bookingPropertyId').value = state.bookingApi.propertyId;
            settingsModal.classList.add('active');
        }

        function hideSettingsModal() {
            settingsModal.classList.remove('active');
        }

        // ê°ì‹¤ ìƒíƒœ ëª¨ë‹¬ í•¨ìˆ˜
        function openRoomStatusModal(roomId) {
            state.selectedRoomId = roomId;
            const status = state.roomStatus[roomId];
            const room = state.rooms.find(r => r.id === roomId);

            document.getElementById('roomStatusTitle').textContent = room.name;
            document.getElementById('roomGuestName').value = status.guestName;
            document.getElementById('roomCheckInTime').value = status.checkInTime;
            document.getElementById('roomCheckOutTime').value = status.checkOutTime;

            // ìƒíƒœ ì˜µì…˜ ìƒì„±
            let statusHtml = `
                <label class="flex items-center gap-3 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 ${status.status === 'empty' ? 'border-green-500 bg-green-50' : ''}">
                    <input type="radio" name="roomStatusRadio" value="empty" ${status.status === 'empty' ? 'checked' : ''} class="w-4 h-4">
                    <span class="flex items-center gap-2"><span class="text-xl">ğŸŸ¢</span> <span class="font-medium">ë¹„ì–´ìˆìŒ</span></span>
                </label>
                <label class="flex items-center gap-3 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 ${status.status === 'occupied' ? 'border-red-500 bg-red-50' : ''}">
                    <input type="radio" name="roomStatusRadio" value="occupied" ${status.status === 'occupied' ? 'checked' : ''} class="w-4 h-4">
                    <span class="flex items-center gap-2"><span class="text-xl">ğŸ”´</span> <span class="font-medium">ìˆ™ë°•ì¤‘</span></span>
                </label>
                <label class="flex items-center gap-3 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 ${status.status === 'cleaning' ? 'border-yellow-500 bg-yellow-50' : ''}">
                    <input type="radio" name="roomStatusRadio" value="cleaning" ${status.status === 'cleaning' ? 'checked' : ''} class="w-4 h-4">
                    <span class="flex items-center gap-2"><span class="text-xl">ğŸŸ¡</span> <span class="font-medium">ì²­ì†Œì¤‘</span></span>
                </label>
            `;
            document.getElementById('statusOptions').innerHTML = statusHtml;

            document.getElementById('roomStatusModal').classList.add('active');
        }

        function hideRoomStatusModal() {
            document.getElementById('roomStatusModal').classList.remove('active');
            state.selectedRoomId = null;
        }

        function saveRoomStatus() {
            const statusRadio = document.querySelector('input[name="roomStatusRadio"]:checked');
            if (!statusRadio) {
                alert('ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }

            const newStatus = statusRadio.value;
            const guestName = document.getElementById('roomGuestName').value;
            const checkInTime = document.getElementById('roomCheckInTime').value;
            const checkOutTime = document.getElementById('roomCheckOutTime').value;

            state.roomStatus[state.selectedRoomId] = {
                status: newStatus,
                guestName: guestName,
                checkInTime: checkInTime,
                checkOutTime: checkOutTime,
            };

            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('roomStatus', JSON.stringify(state.roomStatus));

            hideRoomStatusModal();
            renderRoomStatus();
            alert('ê°ì‹¤ ìƒíƒœê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ë‹¬ë ¥ ë Œë”ë§
        function renderCalendar() {
            const date = state.currentMonth;
            const year = date.getFullYear();
            const month = date.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();

            monthDisplay.textContent = `${year}ë…„ ${month + 1}ì›”`;

            let html = '<div class="min-w-full">';
            
            // ìš”ì¼ í—¤ë”
            html += '<div class="grid grid-cols-7 gap-0 border-b border-gray-200">';
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            dayNames.forEach(day => {
                html += `<div class="p-3 text-center font-semibold text-sm text-gray-600 bg-gray-50 border-r border-gray-200 min-w-20">${day}</div>`;
            });
            html += '</div>';

            // ë‚ ì§œ ê·¸ë¦¬ë“œ
            html += '<div class="grid grid-cols-7 gap-0 auto-rows-max">';

            // ë¹ˆ ì¹¸
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="min-h-24 md:min-h-28 p-2 border-r border-b border-gray-200 bg-white min-w-20 overflow-hidden"><div class="bg-gray-50 h-full"></div></div>';
            }

            // ë‚ ì§œ ì±„ìš°ê¸°
            for (let day = 1; day <= daysInMonth; day++) {
                html += `<div class="min-h-24 md:min-h-28 p-2 border-r border-b border-gray-200 bg-white min-w-20 overflow-hidden">`;
                html += `<div class="font-semibold text-sm text-gray-800 mb-1">${day}</div>`;
                html += '<div class="space-y-1">';

                // ì´ ë‚ ì§œì˜ ì˜ˆì•½ í‘œì‹œ
                const filtered = state.selectedRoom === 'all' 
                    ? state.reservations 
                    : state.reservations.filter(r => r.roomId === parseInt(state.selectedRoom));

                filtered.forEach(res => {
                    const current = new Date(res.checkIn);
                    while (current < res.checkOut) {
                        if (current.getFullYear() === year && 
                            current.getMonth() === month && 
                            current.getDate() === day) {
                            html += `<div class="text-xs px-2 py-1 rounded text-white cursor-pointer truncate font-medium hover:opacity-80 transition reservation-bar ${sourceColors[res.source]}" onclick="showDetailModal(${res.id})">${res.guestName}</div>`;
                            break;
                        }
                        current.setDate(current.getDate() + 1);
                    }
                });

                html += '</div></div>';
            }

            html += '</div></div>';
            calendarDiv.innerHTML = html;
            
            // ê°ì‹¤ ìƒíƒœ ë Œë”ë§
            renderRoomStatus();
        }

        // ê°ì‹¤ ìƒíƒœ ë Œë”ë§
        function renderRoomStatus() {
            const roomStatusGrid = document.getElementById('roomStatusGrid');
            let html = '';

            state.rooms.forEach(room => {
                const status = state.roomStatus[room.id];
                const statusClass = {
                    'occupied': 'bg-red-100 border-red-300 text-red-900',
                    'cleaning': 'bg-yellow-100 border-yellow-300 text-yellow-900',
                    'empty': 'bg-green-100 border-green-300 text-green-900',
                };
                const statusLabel = {
                    'occupied': 'ğŸ  ìˆ™ë°•ì¤‘',
                    'cleaning': 'ğŸ§¹ ì²­ì†Œì¤‘',
                    'empty': 'âœ… ë¹„ì–´ìˆìŒ',
                };
                const statusEmoji = {
                    'occupied': 'ğŸ”´',
                    'cleaning': 'ğŸŸ¡',
                    'empty': 'ğŸŸ¢',
                };

                html += `
                    <div onclick="openRoomStatusModal(${room.id})" class="p-4 rounded-lg border-2 ${statusClass[status.status]} cursor-pointer hover:shadow-lg transition">
                        <div class="flex items-center justify-between mb-2">
                            <p class="font-bold text-lg">${room.name}</p>
                            <span class="text-xl">${statusEmoji[status.status]}</span>
                        </div>
                        <p class="text-sm font-semibold mb-2">${statusLabel[status.status]}</p>
                        ${status.guestName ? `<p class="text-sm font-medium truncate">ğŸ‘¤ ${status.guestName}</p>` : ''}
                        ${status.checkInTime ? `<p class="text-xs opacity-75">ì…ì‹¤: ${status.checkInTime}</p>` : ''}
                        ${status.checkOutTime ? `<p class="text-xs opacity-75">í‡´ì‹¤: ${status.checkOutTime}</p>` : ''}
                    </div>
                `;
            });

            roomStatusGrid.innerHTML = html;
        }

        // ëª¨ë‹¬ í‘œì‹œ
        function showAddModal() {
            addModal.classList.add('active');
        }

        function hideAddModal() {
            addModal.classList.remove('active');
            document.getElementById('modalGuestName').value = '';
            document.getElementById('modalCheckIn').value = '';
            document.getElementById('modalCheckOut').value = '';
            document.getElementById('modalMemo').value = '';
        }

        function showDetailModal(id) {
            const res = state.reservations.find(r => r.id === id);
            if (res) {
                state.selectedReservation = res;
                let html = `
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">ê°ì‹¤</label>
                        <p class="text-lg font-semibold text-gray-900">${res.roomName}</p>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-600 mb-1">ì˜ˆì•½ì</label>
                        <p class="text-lg font-semibold text-gray-900">${res.guestName}</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">ì²´í¬ì¸</label>
                            <p class="font-semibold text-gray-900">${res.checkIn.toLocaleDateString('ko-KR')}</p>
                        </div>

                        <div>
                            <label class="block text-sm text-gray-600 mb-1">ì²´í¬ì•„ì›ƒ</label>
                            <p class="font-semibold text-gray-900">${res.checkOut.toLocaleDateString('ko-KR')}</p>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-600 mb-1">ì˜ˆì•½ ì¶œì²˜</label>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded ${sourceColors[res.source]}"></div>
                            <span class="font-semibold text-gray-900">${sourceLabels[res.source]}</span>
                        </div>
                    </div>
                `;

                if (res.memo) {
                    html += `
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">ë©”ëª¨</label>
                            <p class="text-gray-700 bg-gray-50 p-3 rounded-lg">${res.memo}</p>
                        </div>
                    `;
                }

                html += `
                    <div class="flex gap-3 pt-4">
                        <button id="closeDetailBtnBottom" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition">ë‹«ê¸°</button>
                        <button onclick="deleteReservation(${res.id})" class="flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                            ì‚­ì œ
                        </button>
                    </div>
                `;

                document.getElementById('detailContent').innerHTML = html;
                document.getElementById('closeDetailBtnBottom').onclick = hideDetailModal;
                detailModal.classList.add('active');
            }
        }

        function hideDetailModal() {
            detailModal.classList.remove('active');
            state.selectedReservation = null;
        }

        function deleteReservation(id) {
            state.reservations = state.reservations.filter(r => r.id !== id);
            hideDetailModal();
            renderCalendar();
        }

        function addReservation() {
            const roomId = parseInt(document.getElementById('modalRoomId').value);
            const guestName = document.getElementById('modalGuestName').value;
            const checkIn = new Date(document.getElementById('modalCheckIn').value);
            const checkOut = new Date(document.getElementById('modalCheckOut').value);
            const source = document.getElementById('modalSource').value;
            const memo = document.getElementById('modalMemo').value;

            if (guestName && document.getElementById('modalCheckIn').value && document.getElementById('modalCheckOut').value) {
                const room = state.rooms.find(r => r.id === roomId);
                state.reservations.push({
                    id: Date.now(),
                    roomId: roomId,
                    roomName: room.name,
                    guestName: guestName,
                    checkIn: checkIn,
                    checkOut: checkOut,
                    source: source,
                    memo: memo,
                });
                hideAddModal();
                renderCalendar();
            } else {
                alert('í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        prevBtn.addEventListener('click', () => {
            state.currentMonth = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth() - 1);
            renderCalendar();
        });

        nextBtn.addEventListener('click', () => {
            state.currentMonth = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth() + 1);
            renderCalendar();
        });

        roomFilter.addEventListener('change', (e) => {
            state.selectedRoom = e.target.value;
            renderCalendar();
        });

        addBtn.addEventListener('click', showAddModal);
        document.getElementById('closeAddBtn').addEventListener('click', hideAddModal);
        document.getElementById('cancelAddBtn').addEventListener('click', hideAddModal);
        document.getElementById('saveBtn').addEventListener('click', addReservation);
        document.getElementById('closeDetailBtn').addEventListener('click', hideDetailModal);

        // ì„¤ì • ëª¨ë‹¬ ì´ë²¤íŠ¸
        settingsBtn.addEventListener('click', showSettingsModal);
        document.getElementById('closeSettingsBtn').addEventListener('click', hideSettingsModal);
        document.getElementById('cancelSettingsBtn').addEventListener('click', hideSettingsModal);
        document.getElementById('saveSettingsBtn').addEventListener('click', saveApiSettings);
        document.getElementById('testConnectionBtn').addEventListener('click', testBookingConnection);
        document.getElementById('syncNowBtn').addEventListener('click', syncBookingReservations);

        // ê°ì‹¤ ìƒíƒœ ëª¨ë‹¬ ì´ë²¤íŠ¸
        document.getElementById('closeRoomStatusBtn').addEventListener('click', hideRoomStatusModal);
        document.getElementById('cancelRoomStatusBtn').addEventListener('click', hideRoomStatusModal);
        document.getElementById('saveRoomStatusBtn').addEventListener('click', saveRoomStatus);

        // ì´ˆê¸° ë Œë”ë§
        renderCalendar();
    </script>
</body>
</html>
